
@{
    ViewBag.Title = "FollowUpHist";
}

<div ng-app="RegistrationForm" ng-controller="Home">

    @*<div class="row page-titles">
        <div class="col-md-5 align-self-center">
            <h4 class="text-themecolor">Follow Up History</h4>
        </div>
        <div class="col-md-7 align-self-center">
            <div class="d-flex justify-content-end align-items-center">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="javascript:void(0)">Home</a></li>
                    <li class="breadcrumb-item active">Follow Up History</li>
                </ol>
            </div>
        </div>
    </div>*@

    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header bg-info">
                    <h4 class="m-b-0 text-white">Follow Up History</h4>
                </div>
                <div class="card-body">
                    @* ===============================Follow Up Remarks======================= *@
                    <div id="FollowUpRemarks" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
                        <div class="modal-dialog modal-xl">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title" id="myLargeModalLabel">Follow Remarks About Patient</h4>
                                </div>
                                <form name="PatientSelfRegister">
                                    <div class="form-body form-group">
                                        <div class="row p-t-20">
                                            <div class="col-md-1"></div>
                                            @*<div class="col-md-1"></div>*@
                                            <div class="col-sm-1">
                                                <label class="control-label text-dark" for="MrNo">Mr #:</label>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="input-group">
                                                    <input type="text" ng-model="txtMrNo" class="form-control text-center font-weight-bold" readonly />
                                                </div>
                                            </div>
                                            <div class="col-sm-1">
                                                <label class="control-label text-dark" for="RegNo">Reg #:</label>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="input-group">
                                                    <input type="text" ng-model="txtRegNo" class="form-control text-center font-weight-bold" readonly />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row p-t-20">
                                            <div class="col-md-1"></div>
                                            <div class="col-md-1">
                                                <label class="control-label text-dark" for="ContactVia">Contact Via:</label>
                                            </div>
                                            <div class="col-md-4">
                                                <select class="form-control" ng-model="txtContactVia" ng-blur="GetContctByid()">
                                                    <option value="0" label="-Please Select-"></option>
                                                    <option ng-repeat="item in dtGetContVia" value="{{item.ContactVia}}">{{item.ContactVia}}</option>
                                                </select>
                                            </div>
                                            @*<div class="col-md-1"></div>*@
                                            <div class="col-sm-1">
                                                <label class="control-label text-dark" for="NewFollow">New FollowUp:</label>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="input-group">
                                                    <input type="date" ng-model="txtNewFollow" class="form-control text-center font-weight-bold" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row p-t-20">
                                            <div class="col-md-1"></div>
                                            <div class="col-sm-1">
                                                <label class="control-label text-dark" for="Remarks">Remarks<br />If Any:</label>
                                            </div>
                                            <div class="col-md-9">
                                                <div class="input-group">
                                                    <input type="text" id="Remarks" class="form-control form-input-grey" ng-model="txtRemarks" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row p-t-20">
                                            <div class="col-md-2"></div>
                                            <div class="col-md-2"></div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <button ng-click="On_Clear()" class="btn btn-outline-warning form-control"><i class="icon-refresh"></i> Clear </button>
                                                </div>
                                            </div>
                                            <div class="col-md-1"></div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <button ng-click="SaveData()" ng-hide="CUSaveBtn" ng-disabled="PatientSelfRegister.$invalid" class="btn btn-outline-success form-control"><i class="fa fa-check"></i>Save</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                <div class="tab-pane" id="" role="tabpanel">
                                    <!--row-->
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h4 class="card-title">Update Follow Up History</h4>
                                                    <hr />
                                                    <div class="table-responsive-sm">
                                                        <table class="table-sm table-hover table-bordered text-dark">
                                                            <thead>
                                                                <tr>
                                                                    <th>Contact Via</th>
                                                                    <th>New Follow Up Date</th>
                                                                    <th>Remarks</th>
                                                                    @*<th>Action</th>*@
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr ng-repeat="item in dtGetViewData">
                                                                    <td>{{item.ContactVia}}</td>
                                                                    <td>{{item.NextFollowUpDate | date:dd-MMM-yyyy}}</td>
                                                                    <td>{{item.Status}}</td>
                                                                    @*<td>
                                                            <button type="button" ng-click="GetNewFollow(item.RegNo)" class="btn btn-xs btn-success" alt="default" data-toggle="modal" data-target="#FollowUpRemarks" href="javascript:void(0)"><span class="bi bi-trash"></span></button>
                                                        </td>*@
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <hr />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Row -->
                                </div>
                                <div class="modal-footer">
                                    <button type="button" ng-click="On_Clear();GetFollowHist(txtSitefrm)" class="btn btn-danger waves-effect text-left" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                            <!-- /.modal-content -->
                        </div>
                        <!-- /.modal-dialog -->
                    </div>
                    <div id="SiteFrom" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
                        <div class="modal-dialog modal-xl">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title" id="myLargeModalLabel">Select Patient Site(From)</h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-7">

                                        </div>
                                        <div class="col-md-1">
                                            <label for="CompSearch">Search:</label>
                                        </div>
                                        <div class="col-md-4 form-material">
                                            <input type="text" class="form-control" id="UserSearch" ng-model="SiteFTSearch" />
                                        </div>
                                    </div>
                                    <div class="table-responsive-sm">
                                        <table class="table-sm table-hover table-bordered text-dark">
                                            <thead>
                                                <tr>
                                                    <th>Site ID</th>
                                                    <th>Site Name</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="item in dtGetSFTAll | filter:SiteFTSearch">
                                                    <td><button ng-click="GetSFByID(item.SiteCode)" class="btn btn-link" data-dismiss="modal">{{item.SiteCode}}</button></td>
                                                    <td>{{item.SiteName}}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger waves-effect text-left" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                            <!-- /.modal-content -->
                        </div>
                        <!-- /.modal-dialog -->
                    </div>
                    <div class="row p-t-20">
                        <div class="col-md-1"></div>
                        @*<div class="col-md-1"></div>*@
                        <div class="col-sm-1">
                            <label class="control-label text-dark" for="MrNo">Site ID:</label>
                        </div>
                        <div class="col-md-3">
                            <div class="input-group">
                                <input type="text" id="Sitefrm" class="form-control form-input-grey text-center font-weight-bold" ng-model="txtSitefrm" readonly />
                                <div class="input-group-append">
                                    <button type="button" class="btn btn-info" alt="default" data-toggle="modal" data-target="#SiteFrom" href="javascript:void(0)" ng-click="GetSiteFTall()"><i class="ti-search"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="" role="tabpanel">
                        <!--row-->
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="card-title">Follow Up History</h4>
                                        <hr />
                                        <div class="col-md-12 scrollbar-secondary" style="overflow-x:auto;overflow-y:auto;height:600px; font-size:11px;">
                                            <table class="table table-sm table-bordered table-head-fixed table-hover text-nowrap display">
                                                <thead>
                                                    <tr>
                                                        <th>Sr #</th>
                                                        <th>Reg No</th>
                                                        <th>Token</th>
                                                        <th>Patient Name</th>
                                                        <th>Gender</th>
                                                        <th>Age</th>
                                                        <th>Token Date</th>
                                                        <th>Dr Name</th>
                                                        <th>Follow Up Date</th>
                                                        <th>New Follow Up Date</th>
                                                        <th>Tel 1</th>
                                                        <th>Tel 2</th>
                                                        <th>Days Difference</th>
                                                        <th>New Days Difference</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr ng-repeat="item in dtGetFolow">
                                                        <td>{{$index + 1}}</td>
                                                        <td>{{item.RegNo}}</td>
                                                        <td>{{item.TokenNo}}</td>
                                                        <td>{{item.PatName}}</td>
                                                        <td>{{item.Gender}}</td>
                                                        <td>{{item.Age}}</td>
                                                        <td>{{item.TokenDate | date:dd-MMM-yyyy}}</td>
                                                        <td>{{item.DrName}}</td>
                                                        <td>{{item.FollowupDate | date:dd-MMM-yyyy}}</td>
                                                        <td>{{item.NextFollowUpDate | date:dd-MMM-yyyy}}</td>
                                                        <td>{{item.Tel1}}</td>
                                                        <td>{{item.Tel2}}</td>
                                                        <td>{{item.DaysDiff}}</td>
                                                        <td>{{item.NewDaysDiff}}</td>
                                                        <td>
                                                            <button type="button" ng-click="TransferToken(item.TokenNo,item.RegNo)" class="btn btn-xs btn-success" alt="default" data-toggle="modal" data-target="#FollowUpRemarks" href="javascript:void(0)"><span class="fas fa-eye"></span></button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <hr />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Row -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Row -->
</div>
@section scripts {

    <script>

        var RegistrationForm = angular.module("RegistrationForm", []);
        RegistrationForm.controller("Home", function ($scope, $http) {
            $scope.Notification = function (Type, Heading, Test) {
                //info, warning, success, error
                $.toast({
                    heading: Heading,
                    text: Test,
                    position: 'top-right',
                    loaderBg: '#ff6849',
                    icon: Type,
                    hideAfter: 3500,
                    stack: 6
                });
            };
    //===============Insert New Follow=========================
    $scope.SaveData = function () {
        var displayReq = {
            method: 'POST',
            url: '/FollowUp/Save_NewFollow',
            data: {
                TokenNo:$scope.txtMrNo,
                RegNo:$scope.txtRegNo,
                ContactVia: $scope.txtContactVia,
                NextFollowUpDate: $scope.txtNewFollow,
                Status: $scope.txtRemarks,
                Site: $scope.txtSitefrm
            }
        }
        $http(displayReq).then(function (Return) {
            if (Return.data == "Inserted") {
                $scope.Notification('success', 'Operation Completed', 'Insert New Follow History');
                $scope.GetViewData($scope.txtMrNo);
                $scope.On_Clear();
            }
            else {
                $scope.Notification('error', 'Error Code CU1002', 'Please Contact to Admin');
            }
        }, function myError(Return) {
            $scope.Notification('error', 'Error Code CU0002', 'Please Contact to Admin');
            $scope.On_Clear();
        });
            };
    //===============Transfer Token No to New Follow Up Model=================
            $scope.TransferToken = function (TokenNo,RegNo)
            {
                $scope.txtMrNo = TokenNo;
                $scope.GetViewData(TokenNo);
                $scope.txtRegNo = RegNo;
                $scope.GetContctVia();
                $scope.txtContactVia = '0';
                $scope.txtNewFollow = new Date('01/01/1900');
            };
    //=============Get Contact Via======================
    $scope.GetContctVia = function () {
        var displayReq = {
            method: "POST",
            url: "/FollowUp/Get_ContactVia",
            data: {
            }
        }
        $http(displayReq).then(function (Return) {

            $scope.dtGetContVia = angular.fromJson(Return.data);

        }, function myError(Return) {
            $scope.Notification('error', 'Error Code LC0001', Return.data);
        });
            };
      //Display Site FROM and To
            $scope.GetSiteFTall = function () {
                var displayReq = {
                    method: "POST",
                    url: "/PatHist/Get_SiteFTdata",
                    data: {}
                }
                $http(displayReq).then(function (Return) {
                    $scope.dtGetSFTAll = angular.fromJson(Return.data);
                }, function myError(Return) {
                    $scope.Notification('error', 'Error Code LC0001', Return.data);
                });
            };
            //Data Site FROM Get By ID
            $scope.GetSFByID = function (SiteCode) {
                $scope.txtSitefrm = SiteCode;
                $scope.GetFollowHist(SiteCode);
            };
    //===================Get Contact Via By ID==================
    $scope.GetContctByid = function () {
        var displayReq = {
            method: "POST",
            url: "/FollowUp/Get_ContctViabyid",
            data: {
                Contctid: $scope.txtContactVia
            }
        }
        $http(displayReq).then(function (Return) {
            var dt = angular.fromJson(Return.data);
            if (dt.length > 0) {
                $scope.txtContactVia = dt[0].ContactVia;
            }
            else {
                $scope.txtContactVia = '';
            }
        }, function myError(Return) {
            $scope.Notification('error', 'Error Code LC0001', Return.data);
        });
    };
        //======Get All Data by Id and insert to Follow History table========
        //$scope.GetAllDataByid = function (TokenNo) {
        //var displayReq = {
        //    method: "POST",
        //    url: "/FollowUp/Get_AllDatbyid",
        //    data: {
        //        TokenNo: TokenNo
        //    }
        //}
        //    $http(displayReq).then(function (Return) {
        //        var dt = angular.fromJson(Return.data);
        //        if (dt.length > 0) {
        //            var displayReq = {
        //                method: "POST",
        //                url: "/FollowUp/Save_FollowRec",
        //                data: {
        //                    RegNo: dt[0].RegNo,
        //                    TokenNo: dt[0].TokenNo,
        //                    TokenDate: new Date(dt[0].TokenDate),
        //                    PatName : dt[0].PatName,
        //                    CNIC: dt[0].CNIC,
        //                    DoctorID: dt[0].DoctorID,
        //                    DrName: dt[0].DrName,
        //                    FollowupDate: new Date(dt[0].FollowupDate),
        //                    Remarks: dt[0].Remarks
        //    }
        //            }
        //    $http(displayReq).then(function (Return) {
        //        $scope.GetContctVia();
        //        $scope.On_Clear();
        //        if (Return.data == "Inserted")
        //        {
        //        $scope.Notification('success', 'Operation Completed', 'Save Follow History');
        //    }
        //    else {
        //        $scope.Notification('error', 'Error Code CU1002', 'Please Contact to Admin');
        //    }
        //}, function myError(Return) {
        //    $scope.On_Clear();
        //    $scope.Notification('error', 'Error Code CU0002', 'Please Contact to Admin');
        //});
        //    }
        //}, function myError(Return) {
        //    $scope.Notification('error', 'Error Code LC0001', Return.data);
        //});
        //    };
    //=============View Follow Data=================
    $scope.GetViewData = function (TokenNo) {
        var displayReq = {
            method: "POST",
            url: "/FollowUp/Get_ViewData",
            data:
            {
                TokenNo: TokenNo,
                Site: $scope.txtSitefrm
            }
        }
        $http(displayReq).then(function (Return) {

            $scope.dtGetViewData = angular.fromJson(Return.data);

        }, function myError(Return) {
            $scope.Notification('error', 'Error Code LC0001', Return.data);
        });
            };
        //=============================
       //$scope.GetAllDataByid = function (TokenNo) {
       // var displayReq = {
       //     method: "POST",
       //     url: "/FollowUp/Get_AllDatbyid",
       //     data:
       //     {
       //         TokenNo:TokenNo
       //     }
       // }
       // $http(displayReq).then(function (Return) {

       //  $scope.dtGetViewData = angular.fromJson(Return.data);

       // }, function myError(Return) {
       //     $scope.Notification('error', 'Error Code LC0001', Return.data);
       // });
       // };
           //Display Follow History
            $scope.GetFollowHist = function (SiteFor) {
                var displayReq = {
                    method: "POST",
                    url: "/FollowUp/Get_Followdata",
                    data: {
                        Site:SiteFor
                    }
                }
                $http(displayReq).then(function (Return) {
                    $scope.dtGetFolow = angular.fromJson(Return.data);

                }, function myError(Return) {
                    $scope.Notification('error', 'Error Code LC0001', Return.data);
                });
            };
             //Display New Follow History
            $scope.GetNewFollowHist = function () {
                var displayReq = {
                    method: "POST",
                    url: "/FollowUp/Get_NewFollowdata",
                    data: {}
                }
                $http(displayReq).then(function (Return) {
                    $scope.dtGetnewFolow = angular.fromJson(Return.data);

                }, function myError(Return) {
                    $scope.Notification('error', 'Error Code LC0001', Return.data);
                });
            };
            //$scope.On_Clear = function () {
            //    $scope.GetFollowHist('');
            //};
            //$scope.GetFollowHist();
            $scope.On_Clear = function ()
            {
                $scope.txtContactVia = '0';
                $scope.txtNewFollow = new Date('01/01/1900');
                $scope.txtRemarks = '';

            };
        });
    </script>

}


